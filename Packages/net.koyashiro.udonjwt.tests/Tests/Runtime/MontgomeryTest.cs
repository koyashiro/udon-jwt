using UnityEngine;
using UdonSharp;
using System.Diagnostics;
using Koyashiro.UdonJwt.Numerics;
using Koyashiro.UdonTest;

namespace Koyashiro.UdonJwt.Tests
{
    public class MontgomeryTest : UdonSharpBehaviour
    {
        [SerializeField]
        private Montgomery _montgomery;

        public void Start()
        {
            var sw = new Stopwatch();
            var m = new uint[] { 0x74934dfa, 0xbbbbc41d, 0xb5cafc17, 0xfd48cac9, 0x605c59ba, 0xdccdc848, 0x69e5df7d, 0x3cbca2a0, 0xbda69b8c, 0xaec9d50c, 0x7bb0f7b4, 0x4b595a8c, 0x4f1d3f35, 0x1ef4242b, 0x4d81b1a3, 0x2cd0ec97, 0x24824d4f, 0x9f5542ac, 0x4cefe457, 0x9be35fcc, 0x8e7beb29, 0x581d100a, 0x9139f282, 0x6cd1a6d3, 0xc4f3b03f, 0x24508b15, 0x2a2cd738, 0xcd501e6c, 0x134db049, 0x3fd9cbbb, 0x185e6ef4, 0x98ef4601, 0x030ce621, 0x1870132f, 0x65a2e74b, 0x2a5fb313, 0x58e09c26, 0xcf80d3f9, 0x99a72166, 0x24bea6c8, 0x2648d9f6, 0xa17ec2ca, 0x35fab8e1, 0xcd1b4d1d, 0x68026fe1, 0x5a84f623, 0x0f64bf1b, 0xf399ee87, 0xfdc34b8c, 0x590ccac6, 0xa7e14757, 0x500d3420, 0x4faaec14, 0xeb339ca9, 0x8b2ca97e, 0x3d654f94, 0x59019193, 0x3edb8473, 0xf620992f, 0xdf131b08, 0xd9c33d90, 0x4e02c91a, 0xd3bce471, 0x73f4c387 };
            var c = new uint[] { 0xa7ba2616, 0x4637aa4e, 0x336d7637, 0x9121bafe, 0x66910b81, 0x83881a5b, 0x8502820a, 0x1ab1a2bb, 0x05000420, 0x03040201, 0x86480165, 0x0d060960, 0x00303130, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0xffffffff, 0x0001ffff };
            sw.Start();
            var result = _montgomery.ModPow(m, 65537);
            Assert.Equal(c, result);
            sw.Stop();
            UnityEngine.Debug.Log($"Elapsed: {sw.ElapsedMilliseconds} ms");
        }
    }
}
